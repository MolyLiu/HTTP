#第三章 HTTP报文
如果说HTTP是因特网的信使，那么HTTP报文就是它用来搬东西的包裹。
## 3.1 报文流
HTTP报文是在HTTP应用程序之间发送的数据块。

报文在客户端、服务器和代理之间流动。

这些数据块是以一些文本形式的**元信息**开头。
###3.1.1报文流入源端服务器
HTTP使用术语**流入**和**流出**来描述**事务处理**的方向。

报文流入源端服务器，工作完成之后，会流回用户的Agent代理中。
###3.1.2 报文向下游流动
HTTP报文会向河水一样流动。

所有报文的发送者都在接收者的上游。

不管是请求报文还是响应报文，所有的报文都会向下游流动。
##3.2报文的组成部分
HTTP报文是简单的格式化数据块。

每条报文都包含一条来自客户端的请求，或者一条来自服务端的响应。

报文由三部分组成：

1. 起始行：对报文进行的描述的起始行。
2. 首部块：包含属性的首部块
3. 主体：可选的、包含数据的主体部分。
### 3.2.1 报文的语法
所有的HTTP报文都可以分为两类：请求报文，响应报文。

请求报文和响应报文的基本机构相同。

几个部分：

1. 方法：客户端希望服务器对资源执行的动作。GET,HEAD..
2. 请求URL：命名了所请求资源，或者URL路径组件的完整URL。
3. 版本：报文所使用的HTTP版本，
4. 状态码：这三位数字描述了请求过程中所发生的情况。
5. 原因短语：数字状态码的可读版本，包含行终止序列之前的所有文本。
6. 首部：可以有零个或多个首部
7. 实体的主体部分：实体的主体部分包含一个由任意数据组成的数据块。
###3.2.2 起始行
所有的HTTP报文都以一个起始行作为开始。

请求报文的起始行说明了**要做什么**。
响应报文的起始行说明了**发生了什么**。

-  请求行。

	请求报文请求服务器对资源进行一些操作。请求报文的起始行，或被称为请求行，包含了**一个方法**和**一个请求URL**，这个方法描述了服务器应该执行的操作，请求URL描述了要对哪个资源执行这个方法。
-  响应行。

	响应报文承载了状态信息和操作产生的所有结果数据，将其返回给客户端。响应报文的起始行被称为**响应行**，包含了响应报文中使用的HTTP版本、数字状态码、以及描述操作状态的文本形式的原因短语。
- 方法。

	请求的起始行以方法作为开始，方法用来告知服务器要做些什么。HTTP规范中定义了一组常用的请求方法（GET,HEAD,POST,PUT,TRACE,OPTIONS,DELETE）.除了这些方法，服务器还可能会实现一些自己的请求方法，被称为扩展方法。
- 状态码

	方法是用来告诉服务器做什么事情的。状态码则是用来告诉客户端，发生了什么事儿。

	状态码位于**响应**的起始行中。状态码是在每条**响应报文**的起始行中返回的，会返回一个数字状态码和一个可读的状态。数字码便于程序进行差错处理，原因短语则更便于人们理解。
- 原因短语

	原因短语是响应起始行的最后一个组件。它为状态码提供了文本形式的解释。原因短语和状态码是成对出现的。
- 版本号
	
	版本号会以HTTP/x.y的形式出现在请求和响应报文的起始行中。为HTTP应用程序提供了一种将自己所遵循的**协议版本**告知对方的方式。
###3.2.3 首部
跟在起始行后面的就是零个或者多个HTTP首部字段。本质上说，它们只是一些键值对的列表。

1. 首部分类:HTTP规范定义了几种首部字段。有以下几类：

	- 通用首部：既可以出现在**请求报文**中，也可以出现在**响应报文**中。
	- 请求首部：提供更多有关于请求的信息
	- 响应首部：提供更多有关响应的信息
	- 实体首部：描述主题的长度和内容，或者资源自身。
	- 扩展首部：规范中没有定义的新首部。

2. 首部延续行。将长的首部分为多行可以提高可读性。
### 3.2.4 实体的主体部分
HTTP报文的第三部分是可选择的实体主体部分。实体的主题是HTTP报文的负荷，就是HTTP要传输的内容。HTTP报文可以承载很多类型的数字数据。

##3.3方法
并不是每个服务器都实现了所有的方法。
###3.3.1 安全方法
HTTP定义了一组被称为安全方法的方法。

GET方法和HEAD方法被认为是安全的，也就是说GET和HEAD方法的HTTP不会产生什么动作。

不产生动作，也就是说HTTP请求不会在服务器上产生什么结果。

使用安全方法的**目的**就是当使用可能引发某一动作的不安全方法是，允许HTTP应用程序通知用户。
###3.3.2 GET
GET是最常用的方法。通常用于请求服务器发送某个资源。

###3.3.3 HEAD
HEAD与GET行为很类似，但是服务器在响应中**只**返回首部，不会返回主题。
HEAD好处:
1. 在不活的资源的情况下了解资源的情况。
2. 通过查看响应中的状态码，看看某个对象是否存在
3. 通过查看首部，测试资源是否被修改。
###3.3.4PUT
与GET从服务器读取文档相反，put方法会向服务器中写入文档。
###3.3.5 post
POST方法用于像服务器发送数据，通常会用它来支持HTML的表单。
###3.3.6 TRACE
客户端发起一个请求时，这个请求可能要穿过防火墙、代理、网关或其它一些应用程序。每个中间节点都可能会改变原始的HTTP请求。

TRACE请求会在目的服务器端发起一个“环回”诊断。行程最后一站的服务器会弹回一条TRACE响应，并在响应主体中携带它收到的**原始**请求报文。所以查看原始报文是否被毁坏或者修改过。

TRACE主要用来诊断。
### 3.3.7 OPTIONS
OPTIONS方法，请求Web服务器告知其支持的各种功能。
### 3.3.8 DELETE
DELETE 方法所做的事情就是请服务器删除请求URL所指定的资源。

但是因为HTTP规范允许服务器在不通知客户端的情况下撤销请求，所以客户端无法保证删除操作一定会被执行。
### 3.3.9扩展方法
HTTP被设计成字段可扩展的。
##3.4 状态码
HTTP状态码被分成了五大类。状态码为客户端提供了一种理解事务处理结果的便捷方式。
###3.4.1 100~199信息性状态码
HTTP客户端应用程序有一个实体的主体部分要发送给服务器，但是在发送之前希望查看服务器是否会接受这个实体。以上情景就是**100 Continue状态码**想进行优化的。

1. 客户端与100 Continue:

	如果客户端在向服务器发送一个实体，并且愿意在发送实体之前等到100 Continue响应，那么客户端就要发送一个携带了值为100Continue的Expect请求首部。
	客户端应用程序只有在避免向服务器发送一个服务器无法处理或使用的大实体时，才应该使用100 Continue.
2. 服务器与100 Continue

	服务器永远不应该向没有发送100 Continue期望的客户端发送100 Continue状态。
3. 代理与100 Continue

	当代理从客户端收到一条100 Conitue期望的请求时，它需要先判断自己是否下一跳服务器是否能与哪个版本兼容。可以兼容，则将请求向下转发，不能则进行错误响应。
### 3.4.2 200~200 成功状态码
客户端发起请求时，这些请求通常都是成功的。服务器有一组用来表示成功的状态码。
### 3.4.3 300~399 重定向状态码
重定向状态码要么告知客户端使用替代位置来访问他们所感兴趣的资源，要么要么提供一个替代的响应而不是资源的内容。
### 3.4.4 400~499 客户端错误状态码
### 3.4.5 500~599 服务器错误状态码
##3.5首部
首部和方法配合工作，共同决定了客户端和服务器能做什么事儿。可以将首部分为五个主要的类型：

1. 通用首部
	
	客户端和服务器都可以使用的通用首部。
2. 请求首部

	请求首部是请求报文特有的。他们为服务器提供了一些额外信息，比如客户端希望接受什么类型的数据。
3. 响应首部

	响应报文有自己的首部集，以便为客户端提供信息。
4. 实体首部
	
	实体首部指的是用于应对实体部分的首部。
5. 扩展首部

	扩展首部是非标准的首部，由应用开发者创建。
###3.5.1 通用首部
通用首部：提供了与报文相关的最基本的信息。不论报文的类型。比如Date首部类型。
###3.5.2 请求首部
请求首部只有在请求报文中才会有意义。服务器可以根据请求首部给出的客户端信息，试着为客户端提供更好的响应。

1. Accept首部

	Accept首部为客户端提供了一种将其喜好和能力**告知服务器**的方式。客户端会得到它们想要的内容，服务器则不会浪费其时间和带宽来发送客户端无法使用的东西
2. 条件请求首部
	
	有时候客户端希望为请求加上某些限制。通过条件请求首部，客户端就可以为请求加上这种限制，要求服务器对请求响应之前确保某个条件为真。
3. 安全请求首部

	HTTP本身就支持一种简单的机制，可以对请求进行质询/响应认证。这种机制要求客户端在获取特定的资源之前，先对自身进行认证，这样就可以使事务稍微安全一些。
4. 代理请求首部
### 3.5.3 响应首部
响应报文有自己的响应首部集。响应首部为客户端提供一些额外的信息。这些首部有助于客户端处理响应，并在将来发起更好的响应。

1. 协商首部

	如果资源有多种表示方法——比如，如果服务器上有某文档的法语和德语的译稿，那么HTTP/1.1可以为服务器和客户端提供对资源的协商能力。
2. 安全响应首部

	HTTP的质询/响应认证机制的响应侧。
###3.5.4 实体首部
实体首部提供了有关实体及其内容的大量信息。

实体首部可以告知报文的接受者它对什么进行处理。

1. 内容首部

	内容首部提供了与实体内容有关的特定内容，说明了类型、尺寸以及处理它所需的其他有用信息。
2. 实体缓存首部

	实体缓存首部说明了如何或什么时候进行缓存。实体的缓存首部提供了与被缓存实体的相关的信息。


	

	